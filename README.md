# ü¶ú Hhrrr Pavilion
–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∞–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: **`hhrrr.ru/chat`**.

## –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
* –û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/chat` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.  
* –ê–Ω–æ–Ω–∏–º–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤ `user_XXX`.  
* –û–±—â–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π, —Ö—Ä–∞–Ω–∏–º–∞—è –≤ SQLite.  
* –ü–µ—Ä–≤–∏—á–Ω—ã–π –ø–æ–∫–∞–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π; –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö—Å—è –ø–æ —Å–µ—Å—Å–∏–∏.  
* –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã; –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ–ø—Ä–æ—Å —Å–µ—Ä–≤–µ—Ä–∞ (polling).  
* –ü—Ä–æ—Å—Ç–æ–µ HTTP API —Å –º–µ—Ç–æ–¥–∞–º–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
pavilion/  
‚îú‚îÄ‚îÄ 'df                         # —Ö–∑, –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏–ª–∏ –º—É—Å–æ—Ä–Ω–∞—è –ø–∞–ø–∫–∞
‚îú‚îÄ‚îÄ .gitignore                  # —á—Ç–æ Git –∏–≥–Ω–æ—Ä–∏—Ç
‚îú‚îÄ‚îÄ README.md                   # –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ chat.sqlite                 # –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ —á–∞—Ç–∞
‚îú‚îÄ‚îÄ config                      # –∫–æ–Ω—Ñ–∏–≥–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ migrate.php                 # —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã
‚îú‚îÄ‚îÄ pavilion.sqlite             # –¥–æ–ø. –±–∞–∑–∞ (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤)
‚îú‚îÄ‚îÄ public                      # —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ assets                  # –∫–∞—Ä—Ç–∏–Ω–∫–∏, —à—Ä–∏—Ñ—Ç—ã –∏ —Ç.–ø.
‚îÇ   ‚îú‚îÄ‚îÄ css/main.css            # —Å—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ index.html              # —à–∞–±–ª–æ–Ω/—Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ index.php               # –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ js/main.js              # –ª–æ–≥–∏–∫–∞ —á–∞—Ç–∞: init, send, poll
‚îú‚îÄ‚îÄ server                      # –±—ç–∫–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ MessageRepository.php   # —Ä–∞–±–æ—Ç–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ SessionRepository.php   # —Å–µ—Å—Å–∏–∏ –∏ –∏–º–µ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ api.php                 # API (init, send, poll)
‚îÇ   ‚îú‚îÄ‚îÄ db.php                  # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite
‚îÇ   ‚îî‚îÄ‚îÄ lib                     # –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ tests                       # —Ç–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞

```

## –î–∞–Ω–Ω—ã–µ
**sessions**  
`id` ‚Äî UUID/hex, primary key  
`name` ‚Äî –ø—Å–µ–≤–¥–æ–Ω–∏–º (`user_001`, `user_002`, ‚Ä¶)  
`created_at` ‚Äî ISO‚Äë–¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è  
**messages**  
`id` ‚Äî –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç  
`session_id` ‚Äî —Å–≤—è–∑—å —Å sessions.id  
`author` ‚Äî —Å—Ç—Ä–æ–∫–∞ —Å –∏–º–µ–Ω–µ–º (user_XXX)  
`text` ‚Äî —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è  
`created_at` ‚Äî ISO‚Äë–¥–∞—Ç–∞/–≤—Ä–µ–º—è

## –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã
**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏** (api.php?action=init)  
–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie `chat_session_id` (–µ—Å–ª–∏ –µ—Å—Ç—å).  
API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Å—Å–∏—é –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∏ –æ—Ç–¥–∞—ë—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —á–∞—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏.  
**–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è** (api.php?action=send)  
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è `session_id` –∏ `text`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–µ—Å—Å–∏—è, —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç.  
**–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π** (api.php?action=poll)  
–ó–∞–ø—Ä–æ—Å `action=poll&after_id=...` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å `id > after_id`.  
**–§—Ä–æ–Ω—Ç–µ–Ω–¥** (index.php)  
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, —Ä–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ AJAX, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –æ–ø—Ä–æ—Å —Å–µ—Ä–≤–µ—Ä–∞.

## –ú–æ–¥—É–ª–∏ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
**db.php:** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite (`chat.sqlite`) –∏ –ø–µ—Ä–≤–∏—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü.  
**SessionRepository.php:** –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π; –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º—ë–Ω.  
**MessageRepository.php:** –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π; —á—Ç–µ–Ω–∏–µ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏, –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –∑–∞–ø–∏—Å–µ–π –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ id.  
**api.php:** –ø—Ä–æ—Å—Ç–æ–µ JSON API: `init`, `send`, `poll`.  
**index.php:**  –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π HTML/JS –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–æ—Å–∞/–æ—Ç–ø—Ä–∞–≤–∫–∏.

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
**–ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç**: c–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è; –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏—Å—Ç–æ—Ä–∏–∏.  
**–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–∏–∑–∏—Ç:**  c–µ—Å—Å–∏—è –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –ø–æ cookie; –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.

## –û–∫—Ä—É–∂–µ–Ω–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
- **–û–°:** Linux (Debian/Ubuntu)  
- **–í–µ–±‚Äë—Å–µ—Ä–≤–µ—Ä:** nginx + php‚Äëfpm –∏–ª–∏ Apache + mod_php  
- **PHP:** 7.4+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8.x) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PDO –∏ SQLite  
- **SQLite:** –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ PHP‚Äë–º–æ–¥—É–ª—å `pdo_sqlite`  
- **–ü—Ä–∞–≤–∞:** –≤–µ–±‚Äë–ø—Ä–æ—Ü–µ—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `chat.sqlite`

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ø—Ä–∏–º–µ—Ä –∏–∑ —Ç–µ–∫—É—â–µ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏)**
- **PHP (CLI):** PHP 8.3.6  
- **nginx:** nginx/1.24.0  
- **PHP –º–æ–¥—É–ª–∏:** pdo_sqlite, sqlite3 (–ø–æ–¥–∫–ª—é—á–µ–Ω—ã)  
- **Apache:** –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω / –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
