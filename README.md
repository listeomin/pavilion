# ü¶ú Hhrrr Pavilion
–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∞–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –∏ —á–∏—Å—Ç—ã–º –¥–∏–∑–∞–π–Ω–æ–º.

[https://hhrrr.ru/pavilion/](Hhrrr.ru/Pavilion)

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
* **–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å** ‚Äî —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∏–º–µ–Ω–∞ —Å —ç–º–æ–¥–∑–∏ –∏–∑ `user_names.json` (üê∫ –≤—É–ª—å–≤, ü¶ä –ª–∏—Å—É—Å, ü¶â —Å–æ–≤—É–Ω...)
* **–ê–≤—Ç–æ–ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ .png/.jpg/.gif/.webp –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –∫–∞—Ä—Ç–∏–Ω–∫–∏
* **–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω** ‚Äî Georgia 18px, –±–µ–∑ —Ä–∞–º–æ–∫ –∏ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–æ–≤
* **–ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏** ‚Äî fade-in –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –≥—Ä–∞–¥–∏–µ–Ω—Ç —Ä–∞—Å—Ç–≤–æ—Ä–µ–Ω–∏—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
* **–£–º–Ω–∞—è —Ñ–æ—Ä–º–∞ –≤–≤–æ–¥–∞** ‚Äî –∫–Ω–æ–ø–∫–∞ [–æ—Ç–ø—Ä–∞–≤–∏—Ç—å] –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞
* **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Å–µ—Å—Å–∏–∏** ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ cookie
* **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** ‚Äî polling –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
* **Backend:** PHP 8.5+, SQLite
* **Frontend:** Vanilla JS, Georgia + Ubuntu Mono
* **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Repository pattern, REST API

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/listeomin/pavilion.git
cd pavilion

# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev server
php -S localhost:8000 -t public router.php

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open http://localhost:8000
```

### –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```bash
php seed_messages.php
```

### Production (nginx)
–ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å nginx –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `/pavilion/` –ø—É—Ç—ë–º.
–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```nginx
location /pavilion {
    alias /path/to/pavilion/public;
    try_files $uri $uri/ /pavilion/index.php?$args;
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.5-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $request_filename;
        include fastcgi_params;
    }
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
pavilion/
‚îú‚îÄ‚îÄ .gitignore              # –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã (*.sqlite, .DS_Store)
‚îú‚îÄ‚îÄ README.md               # –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ router.php              # —Ä–æ—É—Ç–µ—Ä –¥–ª—è PHP dev server
‚îú‚îÄ‚îÄ seed_messages.php       # —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ public/                 # —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (document root)
‚îÇ   ‚îú‚îÄ‚îÄ index.php          # –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ css/main.css       # —Å—Ç–∏–ª–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –≤—Å—ë inline)
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ config.js      # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π (localhost vs production)
‚îÇ       ‚îî‚îÄ‚îÄ main.js        # –ª–æ–≥–∏–∫–∞ —á–∞—Ç–∞ (init, send, poll)
‚îî‚îÄ‚îÄ server/                 # –±—ç–∫–µ–Ω–¥
    ‚îú‚îÄ‚îÄ api.php            # REST API (init, send, poll)
    ‚îú‚îÄ‚îÄ db.php             # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite + –º–∏–≥—Ä–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ SessionRepository.php   # —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
    ‚îú‚îÄ‚îÄ MessageRepository.php   # —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
    ‚îî‚îÄ‚îÄ user_names.json    # —Å–ø–∏—Å–æ–∫ —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö –∏–º—ë–Ω —Å —ç–º–æ–¥–∑–∏
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**sessions**
- `id` (TEXT, PRIMARY KEY) ‚Äî UUID —Å–µ—Å—Å–∏–∏
- `name` (TEXT, UNIQUE) ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (üê∫ –≤—É–ª—å–≤, ü¶ä –ª–∏—Å—É—Å...)
- `created_at` (TEXT) ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (ISO 8601)

**messages**
- `id` (INTEGER, PRIMARY KEY, AUTOINCREMENT)
- `session_id` (TEXT, FOREIGN KEY ‚Üí sessions.id)
- `author` (TEXT) ‚Äî –∏–º—è –∞–≤—Ç–æ—Ä–∞
- `text` (TEXT) ‚Äî —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `created_at` (TEXT) ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (ISO 8601)

–ë–∞–∑–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API.

## API

### `GET/POST /server/api.php?action=init`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏. –ï—Å–ª–∏ –µ—Å—Ç—å cookie `chat_session_id` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é, –∏–Ω–∞—á–µ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–æ–æ–±—â–µ–Ω–∏–π.

**Response:**
```json
{
  "session_id": "7e876ec522f8c672956c2b0963c60888",
  "name": "üê∫ –≤—É–ª—å–≤",
  "is_new": false,
  "messages": [...]
}
```

### `POST /server/api.php?action=send`
–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è.

**Request:**
```json
{
  "session_id": "7e876ec522f8c672956c2b0963c60888",
  "text": "–ü—Ä–∏–≤–µ—Ç!"
}
```

**Response:**
```json
{
  "id": 42,
  "session_id": "7e876ec522f8c672956c2b0963c60888",
  "author": "üê∫ –≤—É–ª—å–≤",
  "text": "–ü—Ä–∏–≤–µ—Ç!",
  "created_at": "2025-12-10T14:39:03+00:00"
}
```

### `GET /server/api.php?action=poll&after_id=41`
–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ ID.

**Response:**
```json
{
  "messages": [...]
}
```
